# LLM Judge - ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸ í‰ê°€ ì‹œìŠ¤í…œ

LLM JudgeëŠ” ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸(LLM)ì˜ ì„±ëŠ¥ì„ ì²´ê³„ì ìœ¼ë¡œ í‰ê°€í•˜ê³  ë¶„ì„í•˜ëŠ” Python ê¸°ë°˜ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ LLM ëª¨ë¸ì˜ ì‘ë‹µ í’ˆì§ˆì„ ë‹¤ì¤‘ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€í•˜ê³ , ê²°ê³¼ë¥¼ ì‹œê°í™”í•˜ì—¬ ë¹„êµ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

- **ë‹¤ì¤‘ LLM ëª¨ë¸ ì§€ì›**: KT ë‚´ë¶€ LLM ëª¨ë¸ ë° ì™¸ë¶€ LLM ëª¨ë¸ í‰ê°€ ê°€ëŠ¥
- **ì²´ê³„ì ì¸ í‰ê°€ ê¸°ì¤€**: ì •í™•ì„±, ì¼ê´€ì„±, ì´í•´ë„, ì™„ê²°ì„±, ìš”êµ¬ì‚¬í•­ ë“± ë‹¤ì¤‘ ê¸°ì¤€ í‰ê°€
- **ëŒ€ê·œëª¨ ë°ì´í„°ì…‹ ì²˜ë¦¬**: 702-ìƒ˜í”Œ ë°ì´í„°ì…‹ ê¸°ë°˜ í‰ê°€
- **ìë™í™”ëœ í‰ê°€ í”„ë¡œì„¸ìŠ¤**: í”„ë¡¬í”„íŠ¸ ìƒì„±ë¶€í„° ê²°ê³¼ ë¶„ì„ê¹Œì§€ ìë™í™”
- **ì‹œê°í™” ëŒ€ì‹œë³´ë“œ**: Streamlit ê¸°ë°˜ ê²°ê³¼ ì‹œê°í™” ë° ë¹„êµ ë¶„ì„
- **ê²°ê³¼ íŒŒì‹± ë° ë³€í™˜**: CSV â†’ JSON ë³€í™˜ ë° ë°ì´í„° í†µí•©

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
LLM_Judge/
â”œâ”€â”€ main.py                          # ë©”ì¸ ì‹¤í–‰ íŒŒì¼
â”œâ”€â”€ llm_judge/                       # í•µì‹¬ í‰ê°€ ì—”ì§„
â”‚   â”œâ”€â”€ core.py                      # LLMJudge í´ë˜ìŠ¤ ë° í‰ê°€ ë¡œì§
â”‚   â””â”€â”€ llm_interfaces.py            # LLM API ì¸í„°í˜ì´ìŠ¤
â”œâ”€â”€ dataset/                         # ë°ì´í„° ì²˜ë¦¬ ë° íŒŒì‹±
â”‚   â”œâ”€â”€ 1.tldc_data/                 # Labeling(TLDC)ë°ì´í„°
â”‚   â”œâ”€â”€ 2.answer_data/               # ëª¨ë¸ ì‘ë‹µ ë°ì´í„°
â”‚   â”œâ”€â”€ 3.eval_data/                 # í‰ê°€ìš© ë°ì´í„°ì…‹
â”‚   â”œâ”€â”€ 4.eval_result_data/          # í‰ê°€ ê²°ê³¼ CSV
â”‚   â”œâ”€â”€ 5.matrix_data/               # ë³€í™˜ëœ JSON ê²°ê³¼
â”‚   â”œâ”€â”€ parser_eval_make.py          # í‰ê°€ ë°ì´í„° ìƒì„±ê¸°
â”‚   â””â”€â”€ parser_result.py             # ê²°ê³¼ íŒŒì‹± ë° ë³€í™˜
â”œâ”€â”€ matrix/                          # ì‹œê°í™” ë° ë¶„ì„
â”‚   â”œâ”€â”€ matrix.py                    # Streamlit ëŒ€ì‹œë³´ë“œ
â”‚   â””â”€â”€ matrix.ipynb                 # Jupyter ë…¸íŠ¸ë¶ ë¶„ì„
â”œâ”€â”€ utils/                           # ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ logger.py                    # ë¡œê¹… ì‹œìŠ¤í…œ
â”œâ”€â”€ config/                          # ì„¤ì • íŒŒì¼
â”‚   â””â”€â”€ eval_prompt.yaml             # í‰ê°€ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
â””â”€â”€ logs/                            # ë¡œê·¸ íŒŒì¼
```

## ğŸ› ï¸ ì„¤ì¹˜ ë° ì„¤ì •

### 1. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
uv sync
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  API í‚¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”:

```env
OPENAI_API_KEY=your_openai_api_key_here
```

### 3. ë°ì´í„° ì¤€ë¹„

í‰ê°€í•  ë°ì´í„°ì…‹ì„ `dataset/3.eval_data/` ë””ë ‰í† ë¦¬ì— ì¤€ë¹„í•˜ì„¸ìš”. CSV í˜•ì‹ìœ¼ë¡œ ë‹¤ìŒ ì»¬ëŸ¼ì´ í•„ìš”í•©ë‹ˆë‹¤:

- `no`: ìƒ˜í”Œ ë²ˆí˜¸
- `domain`: ë„ë©”ì¸ (D1~D10)
- `task`: íƒœìŠ¤í¬ (T1~T11)
- `level`: ë‚œì´ë„ (L1~L2)
- `model`: ëª¨ë¸ëª…
- `token_usage`: í† í° ì‚¬ìš©ëŸ‰
- `prompt`: ì›ë³¸ í”„ë¡¬í”„íŠ¸
- `response`: ëª¨ë¸ ì‘ë‹µ

## ğŸš€ ì‚¬ìš©ë²•

### 1. ê¸°ë³¸ í‰ê°€ ì‹¤í–‰

template íŒŒì¼ í˜•íƒœì˜ í‰ê°€ í”„ë¡¬í”„íŠ¸ : /config/eval_proompt.yaml
```python
single_criteria_prompt: |
  [role]
  ë‹¹ì‹ ì€ ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸(LLM)ì´ ìƒì„±í•œ ë‹µë³€ì˜ í’ˆì§ˆì„ í‰ê°€í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. 
  ì œê³µëœ ì›ë˜ í”„ë¡¬í”„íŠ¸ì— ëŒ€í•œ ëª¨ë¸ì‘ë‹µì„ ë°”íƒ•ìœ¼ë¡œ LLMì˜ ë‹µë³€ í’ˆì§ˆì„ ì •í™•í•˜ê²Œ í‰ê°€í•´ ì£¼ì„¸ìš”.
 
  [ì›ë˜ í”„ë¡¬í”„íŠ¸]
  {{prompt}}
  
  [ëª¨ë¸ì‘ë‹µ]
  {{response}}
```

í‰ê°€ ê¸°ì¤€ ì¶”ê°€ ì‚½ì… ê°€ëŠ¥

```python
from llm_judge.core import LLMJudge, EvaluationCriteria
from llm_judge.llm_interfaces import OpenAILLM

# LLM Judge ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
judge = LLMJudge()

# í‰ê°€ ê¸°ì¤€ ì¶”ê°€
judge.add_criteria(EvaluationCriteria(
    name="ì •í™•ì„±", 
    description="ì‘ë‹µì´ ì‚¬ì‹¤ì— ê·¼ê±°í•˜ê³  ì •í™•í•œê°€?", 
    weight=1.5
))
judge.add_criteria(EvaluationCriteria(
    name="ì™„ê²°ì„±", 
    description="ì‘ë‹µì´ ì§ˆë¬¸ì˜ ëª¨ë“  ë¶€ë¶„ì„ ë‹¤ë£¨ëŠ”ê°€?"
))

# ëª¨ë¸ ì¶”ê°€
gpt4_o = OpenAILLM(model_name="gpt-4o")
judge.add_model(gpt4_o)

# ë°ì´í„°ì…‹ ë¡œë“œ ë° í‰ê°€ ì‹¤í–‰
dataset = judge.load_dataset("dataset/3.eval_data/702-samples-eval_gpt-4o.csv")
judge.run_evaluation_on_dataset(dataset, gpt4_o)
```

### 2. ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
python main.py
```

### 3. ê²°ê³¼ ì‹œê°í™”

```bash
cd matrix
streamlit run matrix.py
```

### 4. ë‹¤ì¤‘ CSV íŒŒì¼ ì²˜ë¦¬

```python
from dataset.parser_result import parse_eval_feedback_to_results

# ì—¬ëŸ¬ CSV íŒŒì¼ì„ í•˜ë‚˜ì˜ JSONìœ¼ë¡œ í†µí•©
csv_files = [
    "dataset/4.eval_result_data/702-samples-eval_feedback_midm-mini-inst-2.3.1.csv",
    "dataset/4.eval_result_data/702-samples-eval_feedback_midm-base-inst-2.3.2.csv",
    "dataset/4.eval_result_data/702-samples-eval_feedback_midm-pro-inst-2.3.csv",
    "dataset/4.eval_result_data/702-samples-eval_feedback_llama-3-1-74b.csv"
]

results = parse_eval_feedback_to_results(
    csv_files, 
    "dataset/5.matrix_data/702-samples-eval_result_all.json"
)
```

## ğŸ“Š í‰ê°€ ê¸°ì¤€

ì‹œìŠ¤í…œì€ ë‹¤ìŒ 5ê°€ì§€ ê¸°ì¤€ìœ¼ë¡œ LLM ì‘ë‹µì„ í‰ê°€í•©ë‹ˆë‹¤:

1. **ì •í™•ì„± (Accuracy)**: ì œê³µëœ ì •ë³´ì˜ ì •í™•ì„± (ê°€ì¤‘ì¹˜: 1.5)
2. **ì¼ê´€ì„± (Consistency)**: ì‘ë‹µ ë‚´ ë…¼ë¦¬ì  ì¼ê´€ì„± (ê°€ì¤‘ì¹˜: 1.0)
3. **ì´í•´ë„ (Understanding)**: ì§ˆë¬¸ ì˜ë„ íŒŒì•… ëŠ¥ë ¥ (ê°€ì¤‘ì¹˜: 1.3)
4. **ì™„ê²°ì„± (Completeness)**: ì§ˆë¬¸ì— ëŒ€í•œ í¬ê´„ì  ë‹µë³€ (ê°€ì¤‘ì¹˜: 1.0)
5. **ìš”êµ¬ì‚¬í•­ (Requirements)**: êµ¬ì²´ì ì´ê³  ëª…í™•í•œ ë‹µë³€ (ê°€ì¤‘ì¹˜: 1.0)

## ğŸ”§ ì£¼ìš” í´ë˜ìŠ¤ ë° í•¨ìˆ˜

### LLMJudge
- **í•µì‹¬ í‰ê°€ ì—”ì§„**: ë‹¤ì¤‘ ê¸°ì¤€ í‰ê°€ ë° ê²°ê³¼ ê´€ë¦¬
- **ë©”ì„œë“œ**:
  - `add_criteria()`: í‰ê°€ ê¸°ì¤€ ì¶”ê°€
  - `add_model()`: í‰ê°€í•  ëª¨ë¸ ì¶”ê°€
  - `generate_responses_on_dataset()`: ëª¨ë¸ ì‘ë‹µ ìƒì„±
  - `run_evaluation_on_dataset()`: ë°ì´í„°ì…‹ ê¸°ë°˜ í‰ê°€ ì‹¤í–‰
  - `save_results()`: ê²°ê³¼ ì €ì¥




## ğŸ“ˆ ê²°ê³¼ ë¶„ì„

### ì‹œê°í™” ëŒ€ì‹œë³´ë“œ
- **íˆíŠ¸ë§µ**: ë„ë©”ì¸ë³„, íƒœìŠ¤í¬ë³„, ë‚œì´ë„ë³„ ì ìˆ˜ ì‹œê°í™”
- **ëª¨ë¸ ë¹„êµ**: ì—¬ëŸ¬ ëª¨ë¸ì˜ ì„±ëŠ¥ ë¹„êµ
- **ì¸í„°ë™í‹°ë¸Œ í•„í„°ë§**: ëª¨ë¸ ë° ë°ì´í„° í•„í„°ë§

### ë°ì´í„° í˜•ì‹
í‰ê°€ ê²°ê³¼ëŠ” ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤:

```json
{
  "no": 1,
  "domain": "D1",
  "task": "T1",
  "level": "L1",
  "model": "gpt-4o",
  "token": 150,
  "score": 0.832
}
```

## ğŸ” í‰ê°€ í”„ë¡œì„¸ìŠ¤

1. **ë°ì´í„° ì¤€ë¹„**: TLDC ë°ì´í„° â†’ ëª¨ë¸ ì‘ë‹µ â†’ í‰ê°€ìš© ë°ì´í„°ì…‹
2. **í‰ê°€ ì‹¤í–‰**: ë‹¤ì¤‘ ê¸°ì¤€ í‰ê°€ ë° ê²°ê³¼ ìƒì„±
3. **ê²°ê³¼ íŒŒì‹±**: CSV â†’ JSON ë³€í™˜ ë° í†µí•©
4. **ì‹œê°í™”**: Streamlit ëŒ€ì‹œë³´ë“œë¥¼ í†µí•œ ê²°ê³¼ ë¶„ì„

## ğŸ“ í‰ê°€ ì…‹ ìƒì„±

í‰ê°€ìš© ë°ì´í„° ì…‹ì„ ìƒì„±í•©ë‹ˆë‹¤:
- **parser_eval_make.py**: í‰ê°€ìš© ì •ë‹µì…‹ ê·œê²©í™”(label, response)
- **parser_result.py**: í‰ê°€ê²°ê³¼ ì‹œê°í™”ìš© ë°ì´í„° ë³€í™˜
### ë¡œê·¸ í™•ì¸

```bash
tail -f logs/app.log
```
